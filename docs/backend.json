{
  "entities": {
    "User": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "User",
      "type": "object",
      "description": "Represents a user of the EGX Portfolio Tracker app.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the User entity."
        },
        "email": {
          "type": "string",
          "description": "User's email address.",
          "format": "email"
        },
        "fullName": {
          "type": "string",
          "description": "User's full name."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the user account was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "email",
        "fullName",
        "createdAt"
      ]
    },
    "Investment": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "Investment",
      "type": "object",
      "description": "Represents a single investment made by a user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the Investment entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N Investment)"
        },
        "assetType": {
          "type": "string",
          "description": "Type of asset invested in (e.g., Egyptian Stock, Gold)."
        },
        "purchaseDate": {
          "type": "string",
          "description": "Date when the investment was made.",
          "format": "date-time"
        },
        "amount": {
          "type": "number",
          "description": "Amount invested in the asset."
        },
        "purchasePrice": {
          "type": "number",
          "description": "Price of the asset at the time of purchase."
        }
      },
      "required": [
        "id",
        "userId",
        "assetType",
        "purchaseDate",
        "amount",
        "purchasePrice"
      ]
    },
    "AssetPrice": {
      "$schema": "http://json-schema.org/draft-07schema#",
      "title": "AssetPrice",
      "type": "object",
      "description": "Represents the price of an asset (stock or gold) at a specific point in time.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the AssetPrice entity."
        },
        "assetType": {
          "type": "string",
          "description": "Type of asset (e.g., Egyptian Stock, Gold)."
        },
        "date": {
          "type": "string",
          "description": "Date and time when the price was recorded.",
          "format": "date-time"
        },
        "price": {
          "type": "number",
          "description": "Price of the asset."
        }
      },
      "required": [
        "id",
        "assetType",
        "date",
        "price"
      ]
    },
    "MonthlySummary": {
      "$schema": "http://json-schema.org/draft-07/schema#",
      "title": "MonthlySummary",
      "type": "object",
      "description": "Stores the monthly summary generated by the AI tool for each user.",
      "properties": {
        "id": {
          "type": "string",
          "description": "Unique identifier for the MonthlySummary entity."
        },
        "userId": {
          "type": "string",
          "description": "Reference to User. (Relationship: User 1:N MonthlySummary)"
        },
        "month": {
          "type": "string",
          "description": "The month and year for which the summary is generated (e.g., YYYY-MM)."
        },
        "summary": {
          "type": "string",
          "description": "The AI-generated summary of investment performance for the month."
        },
        "createdAt": {
          "type": "string",
          "description": "Timestamp indicating when the summary was created.",
          "format": "date-time"
        }
      },
      "required": [
        "id",
        "userId",
        "month",
        "summary",
        "createdAt"
      ]
    }
  },
  "auth": {
    "providers": [
      "password",
      "anonymous",
      "phone",
      "emailLink"
    ]
  },
  "firestore": {
    "structure": [
      {
        "path": "/users/{userId}",
        "definition": {
          "entityName": "User",
          "schema": {
            "$ref": "#/backend/entities/User"
          },
          "description": "Stores user profiles. User documents are created upon successful authentication. Path based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user, derived from Firebase Authentication."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/investments/{investmentId}",
        "definition": {
          "entityName": "Investment",
          "schema": {
            "$ref": "#/backend/entities/Investment"
          },
          "description": "Stores investment data for each user. Path based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "investmentId",
              "description": "The unique identifier for the investment."
            }
          ]
        }
      },
      {
        "path": "/assetPrices/{assetPriceId}",
        "definition": {
          "entityName": "AssetPrice",
          "schema": {
            "$ref": "#/backend/entities/AssetPrice"
          },
          "description": "Stores asset price data. Public Read.",
          "params": [
            {
              "name": "assetPriceId",
              "description": "The unique identifier for the asset price entry."
            }
          ]
        }
      },
      {
        "path": "/users/{userId}/monthlySummaries/{monthlySummaryId}",
        "definition": {
          "entityName": "MonthlySummary",
          "schema": {
            "$ref": "#/backend/entities/MonthlySummary"
          },
          "description": "Stores monthly investment summaries generated by the AI tool for each user. Path based ownership.",
          "params": [
            {
              "name": "userId",
              "description": "The unique identifier for the user."
            },
            {
              "name": "monthlySummaryId",
              "description": "The unique identifier for the monthly summary."
            }
          ]
        }
      }
    ],
    "reasoning": "The Firestore data structure is designed to support the EGX Portfolio Tracker application, focusing on secure data access, scalability, and maintainability. It incorporates key principles such as Authorization Independence via denormalization, Structural Segregation for homogeneous security postures, and standardized Access Modeling for consistency.\n\n**Authorization Independence and QAPs:**\n\n*   User data and investments are stored under the `/users/{userId}` path, ensuring that access control can be easily implemented based on the authenticated user ID. This structure avoids the need for complex `get()` calls in security rules, improving performance and security.\n*   The `AssetPrice` collection is global. There is no user specific access, and can be queried without authorization concerns.\n*   The `MonthlySummary` is stored under `/users/{userId}`, ensuring only the current user is able to `list` their data.\n\n**Structural Segregation:**\n\n*   The design segregates user-specific data (investments, monthly summaries) from global data (asset prices). This allows for simpler security rules, as each collection has a well-defined access control policy.\n\n**Access Modeling:**\n\n*   User-owned data (investments, monthly summaries) follows a hierarchical path-based ownership model. This enables efficient and secure access control based solely on the user's ID.\n*   The investments collection under each user allows for easy filtering and listing of investments specific to that user.\n\n**Additional Considerations:**\n\n*   The structure anticipates future needs, such as supporting additional asset types or investment strategies. The use of descriptive field names and consistent data types makes the structure easy to extend and maintain.\n*   The schema defines required fields to ensure data integrity.\n\nThis Firestore structure provides a solid foundation for the EGX Portfolio Tracker application, enabling secure data access, efficient queries, and easy maintenance."
  }
}